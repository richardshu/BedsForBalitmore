var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "./Response", "fetch-everywhere"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Response_1 = __importDefault(require("./Response"));
    var fetch_everywhere_1 = __importDefault(require("fetch-everywhere"));
    var FetchTransport = (function () {
        function FetchTransport() {
        }
        FetchTransport.prototype.roundTrip = function (request) {
            var responsePromise = fetch_everywhere_1.default(request.url, {
                body: request.body,
                headers: request.headers,
                method: request.method
            });
            var responseTextPromise = responsePromise.then(function (response) {
                return response.text();
            });
            return Promise.all([responsePromise, responseTextPromise]).then(function (values) {
                var response = values[0];
                var body = values[1];
                var headers = {};
                response.headers.forEach(function (value, key) {
                    headers[key] = value;
                });
                return new Response_1.default(headers, response.status, body);
            });
        };
        return FetchTransport;
    }());
    exports.default = FetchTransport;
});
//# sourceMappingURL=FetchTransport.js.map